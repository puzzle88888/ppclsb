<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Puzzle</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <img src="/background.jpg" alt="" class="bg-image" style="position:fixed;inset:0;width:100%;height:100%;object-fit:cover;filter:blur(8px) brightness(0.6);z-index:-2;image-rendering:pixelated;" />
  <img src="/3302.jpg" alt="" class="bg-img"/>
  <main class="center">
   <form id="puzzleForm" autocomplete="off" novalidate>
  <label class="label">Your Name:</label>
  <input id="name" name="name" maxlength="64" required />

  <label class="label">Say the word:</label>
  <input id="answer" name="answer" maxlength="64" required />

  <button id="submitBtn" type="submit">Enter</button>

  <div id="msg" aria-live="polite"></div>
</form>
  </main>

  <div id="overlay" class="overlay hidden">
    <div class="overlay-card">
      <p>Congrats on making it here<br/>Capture this moment and share it with the one who sent you down this road</p>
      <button id="closeOverlay">Close</button>
    </div>

  </div>

  <script>
    const form = document.getElementById('puzzleForm');
    const msg = document.getElementById('msg');
    const overlay = document.getElementById('overlay');
    const closeOverlay = document.getElementById('closeOverlay');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      const name = document.getElementById('name').value.trim();
      const answer = document.getElementById('answer').value.trim();
      if (!name || !answer) { msg.textContent = 'Please fill both fields.'; return; }

      document.getElementById('submitBtn').disabled = true;
      msg.textContent = 'Checking…';

      try {
        const res = await fetch('/api/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, answer })
        });
        const j = await res.json();
        if (j.success) {
          overlay.classList.remove('hidden');
        } else if (j.locked) {
          msg.textContent = 'Too many attempts. Try again later.';
        } else {
          msg.textContent = 'Not quite — try again.';
        }
      } catch (err) {
        msg.textContent = 'Network error.';
        console.error(err);
      } finally {
        document.getElementById('submitBtn').disabled = false;
      }
    });

    closeOverlay.addEventListener('click', () => overlay.classList.add('hidden'));
  </script>
</body>
</html>
